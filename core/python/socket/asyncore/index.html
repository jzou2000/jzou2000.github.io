<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
<title>
    My Hugo
</title>

<link rel="stylesheet" type="text/css" href="/css/syntax.css">
<link rel="stylesheet" type="text/css" href="/css/site.css">

  



</head>

<body>
    
 
<div class="header">
  <div class="nav-menu-bar">
    <ul class="nav-menu-bar">
    
      <li class="nav-menu">
        
          Core
          <div class="nav-menu-item">
            
              

  
  
    <a href="/core/algorithm/resources/">Algorithm</a>
  


            
              

  
  
    
      <a href="/core/c&#43;&#43;/debug/sysinternals/">C/C&#43;&#43;</a>
    
  


            
              

  
  
    
      <a href="/core/db/odbc/odbc-api-notes/">Database</a>
    
  


            
              

  
  
    <a href="/core/docker/install/">Docker</a>
  


            
              

  
  
    
      <a href="/core/git/p4/p4recipe/">Git</a>
    
  


            
              

  
  
    <a href="/core/java/load-overload/">Java</a>
  


            
              

  
  
    <a href="/core/jenkins/overview/">Jenkins</a>
  


            
              

  
  
    
      <a href="/core/linux/utils/diff/">Linux</a>
    
  


            
              

  
  
    <a href="/core/misc/vsc/">Misc</a>
  


            
              

  
  
    <a href="/core/network/mitmproxy/">Network</a>
  


            
              

  
  
    <a href="/core/open-source/apache/">Open Source</a>
  


            
              

  
  
    <a href="/core/python/shallow-or-deep/">Python</a>
  


            
              

  
  
    
      <a href="/core/rosetta/container/vector/">Rosetta</a>
    
  


            
              

  
  
    <a href="/core/security/ssh-key/">Security</a>
  


            
              

  
  
    
      <a href="/core/shell/bash/array/">Shell</a>
    
  


            
          </div>
        
      </li>
    
      <li class="nav-menu">
        
          Web
          <div class="nav-menu-item">
            
              

  
  
    <a href="/web/css/align/">CSS</a>
  


            
              

  
  
    <a href="/web/html/overview/">Html</a>
  


            
              

  
  
    <a href="/web/hugo/my-hugo-docker/">Hugo</a>
  


            
              

  
  
    <a href="/web/js/vsc-settings-javascript/">JavaScript</a>
  


            
              

  
  
    <a href="/web/misc/tools/">Misc</a>
  


            
              

  
  
    
      <a href="/web/svg/samples/embed-svg/">SVG</a>
    
  


            
              

  
  
    <a href="/web/vue/vue-quick-start/">Vue</a>
  


            
          </div>
        
      </li>
    
      <li class="nav-menu">
        
          IoT
          <div class="nav-menu-item">
            
              

  
  
    <a href="/iot/arduino/shopping/">Arduino</a>
  


            
              

  
  
    
      <a href="/iot/electronics/audio/microphone-array/">Electroincs</a>
    
  


            
              

  
  
    <a href="/iot/esp/esp32/">Esp</a>
  


            
              

  
  
    <a href="/iot/freecad/online-resources/">FreeCAD</a>
  


            
              

  
  
    <a href="/iot/general/emulator/">General</a>
  


            
          </div>
        
      </li>
    
      <li class="nav-menu">
        
          Blogs
          <div class="nav-menu-item">
            
              

  
  
    <a href="/blogs/2023/04/">2023</a>
  


            
              

  
  
    <a href="/blogs/blood-tests/results/">Blood Tests</a>
  


            
              

  
  
    <a href="/blogs/cancer/calender/">Cancer</a>
  


            
              

  
  
    
      <a href="/blogs/english/proverbs-of-day/200/">English</a>
    
  


            
              

  
  
    <a href="/blogs/recipe/begrette/">Recipe</a>
  


            
              

  
  
    <a href="/blogs/camino/sjpdp/">The French Camino</a>
  


            
              

  
  
    <a href="/blogs/travels/morocco/">Travels</a>
  


            
              

  
  
    <a href="/blogs/vancouver/bookmark/">Vancouver</a>
  


            
              

  
  
    <a href="/blogs/varicose/intro/">Varicose Veins</a>
  


            
              

  
  
    <a href="/blogs/workout/bookmarks/">Workout</a>
  


            
          </div>
        
      </li>
    
    
      <li class="nav-menu">
          Taxonomies
          
<div class="nav-menu-item">
    
    <a href='/categories'>categories</a>
    
    <a href='/tags'>tags</a>
    
</div>

      </li>
    
    </ul>
  </div>
</div>



    
<div>
  
<div class="nav-sidebar">
  
  

  
    
  
  
  <div class='nav-sidebar-title'>Python</div>
  
    
      <label for="recipes">recipes</label>
      <input type="radio" name="nav-sidebar" id="recipes" >
      <div class="nav-sidebar-cascade">
        
          <a href="/core/python/recipes/duck-typing_dict/">duck-typing dict</a>
        
      </div>
    
      <label for="socket">socket</label>
      <input type="radio" name="nav-sidebar" id="socket" checked>
      <div class="nav-sidebar-cascade">
        
          <a href="/core/python/socket/asyncio/">asyncio</a>
        
          <a href="/core/python/socket/asyncore/">asyncore &#43; asynchat</a>
        
          <a href="/core/python/socket/socket/">socket</a>
        
      </div>
    
  

  
  <div class='nav-sidebar-direct'>
  
    
      <a href="/core/python/debug-with-pdb/">pdb</a>
    
  
    
      <a href="/core/python/pip-misc/">pip misc</a>
    
  
    
      <a href="/core/python/pywin32/">pywin32</a>
    
  
    
  
    
      <a href="/core/python/shallow-or-deep/">shallow or deep</a>
    
  
    
      <a href="/core/python/subprocess/">subprocess</a>
    
  
    
  
  </div>
  
</div>

  <div class="content">
  <h1>asyncore &#43; asynchat</h1>
  
  <h2 id="simple-server">Simple Server</h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">print_function</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">asyncore</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">asynchat</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">socket</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">sys</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">traceback</span> <span class="k">as</span> <span class="nn">tb</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">exlib</span> <span class="k">as</span> <span class="nn">x</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">log</span> <span class="o">=</span> <span class="nb">print</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Server</span><span class="p">(</span><span class="n">asyncore</span><span class="o">.</span><span class="n">dispatcher</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;Receives connections and establishes handlers for each client.
</span></span></span><span class="line"><span class="cl"><span class="s2">    &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">address</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">asyncore</span><span class="o">.</span><span class="n">dispatcher</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">create_socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">socket</span><span class="o">.</span><span class="n">setsockopt</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">SOL_SOCKET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SO_REUSEADDR</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">address</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">address</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">socket</span><span class="o">.</span><span class="n">getsockname</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">listen</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">log</span><span class="p">(</span><span class="s1">&#39;listening...</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">address</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">handle_accept</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># Called when a client connects to our socket</span>
</span></span><span class="line"><span class="cl">        <span class="n">client_info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">accept</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="n">Handler</span><span class="p">(</span><span class="n">sock</span><span class="o">=</span><span class="n">client_info</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># We only want to deal with one client at a time,</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># so close as soon as we set up the handler.</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># Normally you would not do this and the server</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># would run forever or until it received instructions</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># to stop.</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">handle_close</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">handle_close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="n">log</span><span class="p">(</span><span class="s1">&#39;server closed&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Handler</span><span class="p">(</span><span class="n">asynchat</span><span class="o">.</span><span class="n">async_chat</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;Handles echoing messages from a single client.
</span></span></span><span class="line"><span class="cl"><span class="s2">    &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Artificially reduce buffer sizes to illustrate</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># sending and receiving partial messages.</span>
</span></span><span class="line"><span class="cl">    <span class="n">ac_in_buffer_size</span> <span class="o">=</span> <span class="mi">8</span>
</span></span><span class="line"><span class="cl">    <span class="n">ac_out_buffer_size</span> <span class="o">=</span> <span class="mi">8</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sock</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">log</span><span class="p">(</span><span class="s1">&#39;accept: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sock</span><span class="o">.</span><span class="n">getpeername</span><span class="p">()))</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">received_chunks</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">        <span class="n">asynchat</span><span class="o">.</span><span class="n">async_chat</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sock</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">set_terminator</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>                     <span class="c1"># byte, not string</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">collect_incoming_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">        Read an incoming message from the client and put it into our outgoing queue.
</span></span></span><span class="line"><span class="cl"><span class="s2">        &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="n">x</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s1">&#39;    incoming: </span><span class="si">{}</span><span class="s1"> (</span><span class="si">{}</span><span class="s1"> bytes)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">        <span class="n">log</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">received_chunks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">found_terminator</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&#34;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s2">        Terminator is found in incoming stream, but terminator itself is not put into the incoming queue.
</span></span></span><span class="line"><span class="cl"><span class="s2">        &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="n">log</span><span class="p">(</span><span class="s1">&#39;====found_terminator&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">data</span> <span class="o">=</span> <span class="sa">b</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">received_chunks</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">x</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s1">&#39;total data: </span><span class="si">{}</span><span class="s1"> (len=</span><span class="si">{}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="ow">not</span> <span class="n">x</span><span class="o">.</span><span class="n">is_py2</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf8&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">log</span><span class="p">(</span><span class="s1">&#39;str: [</span><span class="si">{}</span><span class="s1">]</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="bp">self</span><span class="o">.</span><span class="n">received_chunks</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">port</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">    <span class="k">except</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">port</span> <span class="o">=</span> <span class="mi">9900</span>
</span></span><span class="line"><span class="cl">    <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">svr</span> <span class="o">=</span> <span class="n">Server</span><span class="p">((</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">port</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="n">asyncore</span><span class="o">.</span><span class="n">loop</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="n">tb</span><span class="o">.</span><span class="n">format_exc</span><span class="p">())</span>
</span></span></code></pre></div><p>Here are result of run, using <a href="../socket/#ex_sender">ex-sender.py</a></p>
<p>ex-sender.py</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">jasonz@VANLWIN0056:/mnt/c/codex/py$ python ex-sender.py <span class="m">9900</span>
</span></span><span class="line"><span class="cl">input: 12汉字345abcdefghij<span class="se">\n</span>ABCD123456789<span class="se">\n</span>
</span></span><span class="line"><span class="cl">your input: <span class="nv">len</span><span class="o">=</span><span class="m">36</span> <span class="o">[</span>12汉字345abcdefghij
</span></span><span class="line"><span class="cl">ABCD123456789
</span></span><span class="line"><span class="cl"><span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="m">31</span> <span class="m">32</span> e6 b1 <span class="m">89</span> e5 ad <span class="m">97</span> - <span class="m">33</span> <span class="m">34</span> <span class="m">35</span> <span class="m">61</span> <span class="m">62</span> <span class="m">63</span> <span class="m">64</span> <span class="m">65</span>
</span></span><span class="line"><span class="cl"><span class="m">66</span> <span class="m">67</span> <span class="m">68</span> <span class="m">69</span> 6a 0a <span class="m">41</span> <span class="m">42</span> - <span class="m">43</span> <span class="m">44</span> <span class="m">31</span> <span class="m">32</span> <span class="m">33</span> <span class="m">34</span> <span class="m">35</span> <span class="m">36</span>
</span></span><span class="line"><span class="cl"><span class="m">37</span> <span class="m">38</span> <span class="m">39</span> 0a
</span></span><span class="line"><span class="cl">send: <span class="o">(</span>4<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="m">31</span> <span class="m">32</span> e6 b1
</span></span><span class="line"><span class="cl">send: <span class="o">(</span>32<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="m">89</span> e5 ad <span class="m">97</span> <span class="m">33</span> <span class="m">34</span> <span class="m">35</span> <span class="m">61</span> - <span class="m">62</span> <span class="m">63</span> <span class="m">64</span> <span class="m">65</span> <span class="m">66</span> <span class="m">67</span> <span class="m">68</span> <span class="m">69</span>
</span></span><span class="line"><span class="cl">6a 0a <span class="m">41</span> <span class="m">42</span> <span class="m">43</span> <span class="m">44</span> <span class="m">31</span> <span class="m">32</span> - <span class="m">33</span> <span class="m">34</span> <span class="m">35</span> <span class="m">36</span> <span class="m">37</span> <span class="m">38</span> <span class="m">39</span> 0a
</span></span><span class="line"><span class="cl">input:
</span></span><span class="line"><span class="cl">jasonz@VANLWIN0056:/mnt/c/codex/py$
</span></span></code></pre></div><p>ex-svr-simple.py in python2</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">jasonz@VANLWIN0056:/mnt/c/codex/py$ python ex-svr-simple.py
</span></span><span class="line"><span class="cl">listening...<span class="o">(</span><span class="s1">&#39;0.0.0.0&#39;</span>, 9900<span class="o">)</span>
</span></span><span class="line"><span class="cl">accept: <span class="o">(</span><span class="s1">&#39;127.0.0.1&#39;</span>, 59842<span class="o">)</span>
</span></span><span class="line"><span class="cl">server closed
</span></span><span class="line"><span class="cl">    incoming: &lt;<span class="nb">type</span> <span class="s1">&#39;str&#39;</span>&gt; <span class="o">(</span><span class="m">4</span> bytes<span class="o">)</span> 18:18:28
</span></span><span class="line"><span class="cl"><span class="m">31</span> <span class="m">32</span> e6 b1
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    incoming: &lt;<span class="nb">type</span> <span class="s1">&#39;str&#39;</span>&gt; <span class="o">(</span><span class="m">8</span> bytes<span class="o">)</span> 18:18:29
</span></span><span class="line"><span class="cl"><span class="m">89</span> e5 ad <span class="m">97</span> <span class="m">33</span> <span class="m">34</span> <span class="m">35</span> <span class="m">61</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    incoming: &lt;<span class="nb">type</span> <span class="s1">&#39;str&#39;</span>&gt; <span class="o">(</span><span class="m">8</span> bytes<span class="o">)</span> 18:18:29
</span></span><span class="line"><span class="cl"><span class="m">62</span> <span class="m">63</span> <span class="m">64</span> <span class="m">65</span> <span class="m">66</span> <span class="m">67</span> <span class="m">68</span> <span class="m">69</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    incoming: &lt;<span class="nb">type</span> <span class="s1">&#39;str&#39;</span>&gt; <span class="o">(</span><span class="m">1</span> bytes<span class="o">)</span> 18:18:29
</span></span><span class="line"><span class="cl"><span class="nv">6a</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">====</span>found_terminator 18:18:29
</span></span><span class="line"><span class="cl">total data: &lt;<span class="nb">type</span> <span class="s1">&#39;str&#39;</span>&gt; <span class="o">(</span><span class="nv">len</span><span class="o">=</span>21<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="m">31</span> <span class="m">32</span> e6 b1 <span class="m">89</span> e5 ad <span class="m">97</span> - <span class="m">33</span> <span class="m">34</span> <span class="m">35</span> <span class="m">61</span> <span class="m">62</span> <span class="m">63</span> <span class="m">64</span> <span class="m">65</span>
</span></span><span class="line"><span class="cl"><span class="m">66</span> <span class="m">67</span> <span class="m">68</span> <span class="m">69</span> 6a
</span></span><span class="line"><span class="cl">str: <span class="o">[</span>12汉字345abcdefghij<span class="o">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    incoming: &lt;<span class="nb">type</span> <span class="s1">&#39;str&#39;</span>&gt; <span class="o">(</span><span class="m">6</span> bytes<span class="o">)</span> 18:18:29
</span></span><span class="line"><span class="cl"><span class="m">41</span> <span class="m">42</span> <span class="m">43</span> <span class="m">44</span> <span class="m">31</span> <span class="m">32</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    incoming: &lt;<span class="nb">type</span> <span class="s1">&#39;str&#39;</span>&gt; <span class="o">(</span><span class="m">7</span> bytes<span class="o">)</span> 18:18:29
</span></span><span class="line"><span class="cl"><span class="m">33</span> <span class="m">34</span> <span class="m">35</span> <span class="m">36</span> <span class="m">37</span> <span class="m">38</span> <span class="nv">39</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">====</span>found_terminator 18:18:29
</span></span><span class="line"><span class="cl">total data: &lt;<span class="nb">type</span> <span class="s1">&#39;str&#39;</span>&gt; <span class="o">(</span><span class="nv">len</span><span class="o">=</span>13<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="m">41</span> <span class="m">42</span> <span class="m">43</span> <span class="m">44</span> <span class="m">31</span> <span class="m">32</span> <span class="m">33</span> <span class="m">34</span> - <span class="m">35</span> <span class="m">36</span> <span class="m">37</span> <span class="m">38</span> <span class="m">39</span>
</span></span><span class="line"><span class="cl">str: <span class="o">[</span>ABCD123456789<span class="o">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">jasonz@VANLWIN0056:/mnt/c/codex/py$
</span></span></code></pre></div><p>server on python3</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">jasonz@VANLWIN0056:/mnt/c/codex/py$ python3 ex-svr-simple.py
</span></span><span class="line"><span class="cl">listening...<span class="o">(</span><span class="s1">&#39;0.0.0.0&#39;</span>, 9900<span class="o">)</span>
</span></span><span class="line"><span class="cl">accept: <span class="o">(</span><span class="s1">&#39;127.0.0.1&#39;</span>, 59838<span class="o">)</span>
</span></span><span class="line"><span class="cl">server closed
</span></span><span class="line"><span class="cl">    incoming: &lt;class <span class="s1">&#39;bytes&#39;</span>&gt; <span class="o">(</span><span class="m">4</span> bytes<span class="o">)</span> 18:10:02
</span></span><span class="line"><span class="cl"><span class="m">31</span> <span class="m">32</span> e6 b1
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    incoming: &lt;class <span class="s1">&#39;bytes&#39;</span>&gt; <span class="o">(</span><span class="m">8</span> bytes<span class="o">)</span> 18:10:03
</span></span><span class="line"><span class="cl"><span class="m">89</span> e5 ad <span class="m">97</span> <span class="m">33</span> <span class="m">34</span> <span class="m">35</span> <span class="m">61</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    incoming: &lt;class <span class="s1">&#39;bytes&#39;</span>&gt; <span class="o">(</span><span class="m">8</span> bytes<span class="o">)</span> 18:10:03
</span></span><span class="line"><span class="cl"><span class="m">62</span> <span class="m">63</span> <span class="m">64</span> <span class="m">65</span> <span class="m">66</span> <span class="m">67</span> <span class="m">68</span> <span class="m">69</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    incoming: &lt;class <span class="s1">&#39;bytes&#39;</span>&gt; <span class="o">(</span><span class="m">1</span> bytes<span class="o">)</span> 18:10:03
</span></span><span class="line"><span class="cl"><span class="nv">6a</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">====</span>found_terminator 18:10:03
</span></span><span class="line"><span class="cl">total data: &lt;class <span class="s1">&#39;bytes&#39;</span>&gt; <span class="o">(</span><span class="nv">len</span><span class="o">=</span>21<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="m">31</span> <span class="m">32</span> e6 b1 <span class="m">89</span> e5 ad <span class="m">97</span> - <span class="m">33</span> <span class="m">34</span> <span class="m">35</span> <span class="m">61</span> <span class="m">62</span> <span class="m">63</span> <span class="m">64</span> <span class="m">65</span>
</span></span><span class="line"><span class="cl"><span class="m">66</span> <span class="m">67</span> <span class="m">68</span> <span class="m">69</span> 6a
</span></span><span class="line"><span class="cl">str: <span class="o">[</span>12汉字345abcdefghij<span class="o">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    incoming: &lt;class <span class="s1">&#39;bytes&#39;</span>&gt; <span class="o">(</span><span class="m">6</span> bytes<span class="o">)</span> 18:10:03
</span></span><span class="line"><span class="cl"><span class="m">41</span> <span class="m">42</span> <span class="m">43</span> <span class="m">44</span> <span class="m">31</span> <span class="m">32</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    incoming: &lt;class <span class="s1">&#39;bytes&#39;</span>&gt; <span class="o">(</span><span class="m">7</span> bytes<span class="o">)</span> 18:10:03
</span></span><span class="line"><span class="cl"><span class="m">33</span> <span class="m">34</span> <span class="m">35</span> <span class="m">36</span> <span class="m">37</span> <span class="m">38</span> <span class="nv">39</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">====</span>found_terminator 18:10:03
</span></span><span class="line"><span class="cl">total data: &lt;class <span class="s1">&#39;bytes&#39;</span>&gt; <span class="o">(</span><span class="nv">len</span><span class="o">=</span>13<span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="m">41</span> <span class="m">42</span> <span class="m">43</span> <span class="m">44</span> <span class="m">31</span> <span class="m">32</span> <span class="m">33</span> <span class="m">34</span> - <span class="m">35</span> <span class="m">36</span> <span class="m">37</span> <span class="m">38</span> <span class="m">39</span>
</span></span><span class="line"><span class="cl">str: <span class="o">[</span>ABCD123456789<span class="o">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">jasonz@VANLWIN0056:/mnt/c/codex/py$
</span></span></code></pre></div><p>Note:</p>
<ul>
<li>data are received in chunks, which is decided by data size or buffer size</li>
<li>chunk may also break at terminator, so terminator is never in chunks</li>
<li>socket send/recv data by bytes (not characters)
<ul>
<li>unicode char may be broken into two chunks</li>
<li>python3 need to decode bytes to string</li>
</ul>
</li>
</ul>
<h2 id="simple-client">Simple Client</h2>


</div>
</div>

    
    
    
</body>
</html>
