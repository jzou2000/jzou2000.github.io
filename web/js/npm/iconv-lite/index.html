<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
<title>
    My Hugo
</title>

<link rel="stylesheet" type="text/css" href="/css/syntax.css">
<link rel="stylesheet" type="text/css" href="/css/site.css">

  



</head>

<body>
    
 
<div class="header">
  <div class="nav-menu-bar">
    <ul class="nav-menu-bar">
    
      <li class="nav-menu">
        
          Core
          <div class="nav-menu-item">
            
              

  
  
    <a href="/core/algorithm/resources/">Algorithm</a>
  


            
              

  
  
    
      <a href="/core/c&#43;&#43;/debug/sysinternals/">C/C&#43;&#43;</a>
    
  


            
              

  
  
    
      <a href="/core/db/odbc/odbc-api-notes/">Database</a>
    
  


            
              

  
  
    <a href="/core/docker/install/">Docker</a>
  


            
              

  
  
    
      <a href="/core/git/p4/p4recipe/">Git</a>
    
  


            
              

  
  
    <a href="/core/java/load-overload/">Java</a>
  


            
              

  
  
    <a href="/core/jenkins/overview/">Jenkins</a>
  


            
              

  
  
    
      <a href="/core/linux/utils/diff/">Linux</a>
    
  


            
              

  
  
    <a href="/core/misc/vsc/">Misc</a>
  


            
              

  
  
    <a href="/core/network/mitmproxy/">Network</a>
  


            
              

  
  
    <a href="/core/open-source/apache/">Open Source</a>
  


            
              

  
  
    <a href="/core/python/shallow-or-deep/">Python</a>
  


            
              

  
  
    
      <a href="/core/rosetta/container/vector/">Rosetta</a>
    
  


            
              

  
  
    <a href="/core/security/ssh-key/">Security</a>
  


            
              

  
  
    
      <a href="/core/shell/bash/array/">Shell</a>
    
  


            
          </div>
        
      </li>
    
      <li class="nav-menu">
        
          Web
          <div class="nav-menu-item">
            
              

  
  
    <a href="/web/css/align/">CSS</a>
  


            
              

  
  
    <a href="/web/html/overview/">Html</a>
  


            
              

  
  
    <a href="/web/hugo/my-hugo-docker/">Hugo</a>
  


            
              

  
  
    <a href="/web/js/vsc-settings-javascript/">JavaScript</a>
  


            
              

  
  
    <a href="/web/misc/tools/">Misc</a>
  


            
              

  
  
    
      <a href="/web/svg/samples/embed-svg/">SVG</a>
    
  


            
              

  
  
    <a href="/web/vue/vue-quick-start/">Vue</a>
  


            
          </div>
        
      </li>
    
      <li class="nav-menu">
        
          IoT
          <div class="nav-menu-item">
            
              

  
  
    <a href="/iot/arduino/shopping/">Arduino</a>
  


            
              

  
  
    
      <a href="/iot/electronics/audio/microphone-array/">Electroincs</a>
    
  


            
              

  
  
    <a href="/iot/esp/esp32/">Esp</a>
  


            
              

  
  
    <a href="/iot/freecad/online-resources/">FreeCAD</a>
  


            
              

  
  
    <a href="/iot/general/emulator/">General</a>
  


            
          </div>
        
      </li>
    
      <li class="nav-menu">
        
          Blogs
          <div class="nav-menu-item">
            
              

  
  
    <a href="/blogs/2023/04/">2023</a>
  


            
              

  
  
    <a href="/blogs/blood-tests/results/">Blood Tests</a>
  


            
              

  
  
    <a href="/blogs/cancer/calender/">Cancer</a>
  


            
              

  
  
    
      <a href="/blogs/english/proverbs-of-day/200/">English</a>
    
  


            
              

  
  
    <a href="/blogs/recipe/begrette/">Recipe</a>
  


            
              

  
  
    <a href="/blogs/camino/sjpdp/">The French Camino</a>
  


            
              

  
  
    <a href="/blogs/travels/morocco/">Travels</a>
  


            
              

  
  
    <a href="/blogs/vancouver/bookmark/">Vancouver</a>
  


            
              

  
  
    <a href="/blogs/varicose/intro/">Varicose Veins</a>
  


            
              

  
  
    <a href="/blogs/workout/bookmarks/">Workout</a>
  


            
          </div>
        
      </li>
    
    
      <li class="nav-menu">
          Taxonomies
          
<div class="nav-menu-item">
    
    <a href='/categories'>categories</a>
    
    <a href='/tags'>tags</a>
    
</div>

      </li>
    
    </ul>
  </div>
</div>



    
<div>
  
<div class="nav-sidebar">
  
  

  
    
  
  
  <div class='nav-sidebar-title'>JavaScript</div>
  
    
      <label for="Embedded JS Engine">Embedded JS Engine</label>
      <input type="radio" name="nav-sidebar" id="Embedded JS Engine" >
      <div class="nav-sidebar-cascade">
        
          <a href="/web/js/embedded/overview/">overview</a>
        
          <a href="/web/js/embedded/build/">Build qjs</a>
        
      </div>
    
      <label for="Node.js">Node.js</label>
      <input type="radio" name="nav-sidebar" id="Node.js" >
      <div class="nav-sidebar-cascade">
        
          <a href="/web/js/node/express-tips/">express.js</a>
        
          <a href="/web/js/node/https-express/">https with express.js</a>
        
          <a href="/web/js/node/node-pkg/">Packing into a single binary</a>
        
          <a href="/web/js/node/fswalk/">fswalk</a>
        
      </div>
    
      <label for="Npm">Npm</label>
      <input type="radio" name="nav-sidebar" id="Npm" checked>
      <div class="nav-sidebar-cascade">
        
          <a href="/web/js/npm/common-modules/">common modules index</a>
        
          <a href="/web/js/npm/usage/">common usage</a>
        
          <a href="/web/js/npm/npm/">npm</a>
        
          <a href="/web/js/npm/better-sqlite3/">better-sqlite3</a>
        
          <a href="/web/js/npm/commander/">commander.js</a>
        
          <a href="/web/js/npm/express&#43;axios/">express &#43; axios</a>
        
          <a href="/web/js/npm/fast-xml-parser/">fast-xml-parser</a>
        
          <a href="/web/js/npm/iconv-lite/">iconv-lite</a>
        
          <a href="/web/js/npm/js-levenshtein/">js-levenshtein</a>
        
          <a href="/web/js/npm/js-yaml/">js-yaml</a>
        
          <a href="/web/js/npm/markdown-it&#43;highlight/">markdonw-it &#43; highlight.js</a>
        
          <a href="/web/js/npm/nedb/">nedb</a>
        
          <a href="/web/js/npm/sax/">sax</a>
        
          <a href="/web/js/npm/socket.io/">socket.io</a>
        
      </div>
    
  

  
  <div class='nav-sidebar-direct'>
  
    
      <a href="/web/js/bookmark/">bookmarks</a>
    
  
    
      <a href="/web/js/externl-dom/">external DOM elements</a>
    
  
    
      <a href="/web/js/framework/">framework</a>
    
  
    
      <a href="/web/js/vsc-settings-javascript/">play with vsc</a>
    
  
    
  
    
  
    
  
    
      <a href="/web/js/tutorials/">tutorial</a>
    
  
  </div>
  
</div>

  <div class="content">
  <h1>iconv-lite</h1>
  
  <p>This script opens a file stream and detect the encoding.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">log</span> <span class="o">=</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;fs&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">iconv</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;iconv-lite&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">args</span> <span class="o">=</span> <span class="nx">process</span><span class="p">.</span><span class="nx">argv</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">fname</span> <span class="o">=</span> <span class="nx">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">||</span> <span class="s1">&#39;sample.txt&#39;</span>
</span></span><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">encoding</span> <span class="o">=</span> <span class="nx">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">log</span><span class="p">(</span><span class="sb">`fname=</span><span class="si">${</span><span class="nx">fname</span><span class="si">}</span><span class="sb"> encoding=</span><span class="si">${</span><span class="nx">encoding</span><span class="si">}</span><span class="sb">`</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// show upto 16 items of data or 33 characters if data is string
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">function</span> <span class="nx">show_data</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="nx">title</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">log</span><span class="p">(</span><span class="sb">`</span><span class="si">${</span><span class="nx">title</span><span class="si">}</span><span class="sb">: length=</span><span class="si">${</span><span class="nx">data</span><span class="p">.</span><span class="nx">length</span><span class="si">}</span><span class="sb">`</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">data</span> <span class="o">===</span> <span class="s1">&#39;string&#39;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">log</span><span class="p">(</span><span class="sb">`    </span><span class="si">${</span><span class="nx">data</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">33</span><span class="p">)</span><span class="si">}</span><span class="sb">`</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">log</span><span class="p">(</span><span class="sb">`    </span><span class="si">${</span><span class="nx">data</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">16</span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span><span class="si">}</span><span class="sb">`</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// use fs stream directly: node.js has limited encodings
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">try</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">fs</span><span class="p">.</span><span class="nx">createReadStream</span><span class="p">(</span><span class="nx">fname</span><span class="p">,</span> <span class="p">{</span><span class="nx">encoding</span><span class="o">:</span> <span class="nx">encoding</span><span class="p">})</span>
</span></span><span class="line"><span class="cl">    <span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">        <span class="nx">show_data</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="s1">&#39;fs&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="p">.</span><span class="nx">close</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">})</span>
</span></span><span class="line"><span class="cl">    <span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;fs.createReadStream: error&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">log</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="k">catch</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">log</span><span class="p">(</span><span class="sb">`\nfs.createReadStream: </span><span class="si">${</span><span class="nx">e</span><span class="si">}</span><span class="sb">\n`</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// create a stream (returned from a resolved promise)
</span></span></span><span class="line"><span class="cl"><span class="c1">// that uses iconv-lite as a helper if needed
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">async</span> <span class="kd">function</span> <span class="nx">createStream</span><span class="p">(</span><span class="nx">fname</span><span class="p">,</span> <span class="nx">encoding</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nx">encoding</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// if node.js knows it, use it directly
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="k">return</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">createReadStream</span><span class="p">(</span><span class="nx">fname</span><span class="p">,</span> <span class="p">{</span><span class="nx">encoding</span><span class="o">:</span> <span class="nx">encoding</span><span class="p">})</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// otherwise pipe the fs stream to iconv and let iconv decode
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="c1">// fs will check encoding before perform real create
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="kd">var</span> <span class="nx">rs</span> <span class="o">=</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">createReadStream</span><span class="p">(</span><span class="nx">fname</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="kd">var</span> <span class="nx">es</span> <span class="o">=</span> <span class="nx">rs</span><span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">iconv</span><span class="p">.</span><span class="nx">decodeStream</span><span class="p">(</span><span class="nx">encoding</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">            <span class="nx">es</span><span class="p">.</span><span class="nx">__src</span> <span class="o">=</span> <span class="nx">rs</span>
</span></span><span class="line"><span class="cl">            <span class="nx">es</span><span class="p">.</span><span class="nx">close</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">__src</span><span class="p">.</span><span class="nx">close</span><span class="p">()}</span>  <span class="c1">// simulate rs.close
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="k">return</span> <span class="nx">es</span>                                   <span class="c1">// resolve iconv stream
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// encoding is not specified, peek the first chunk, detect the encoding, then pipe through
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">return</span> <span class="k">new</span> <span class="nb">Promise</span><span class="p">((</span><span class="nx">resolve</span><span class="p">,</span> <span class="nx">reject</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kd">var</span> <span class="nx">rs</span> <span class="o">=</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">createReadStream</span><span class="p">(</span><span class="nx">fname</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nx">rs</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="kd">let</span> <span class="nx">enc</span> <span class="o">=</span> <span class="s1">&#39;utf8&#39;</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="p">((</span><span class="nx">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mh">0xff</span> <span class="o">&amp;&amp;</span> <span class="nx">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mh">0xfe</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="nx">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="nx">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="nx">enc</span> <span class="o">=</span> <span class="s1">&#39;utf16-le&#39;</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">((</span><span class="nx">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mh">0xfe</span> <span class="o">&amp;&amp;</span> <span class="nx">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mh">0xff</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="nx">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="nx">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="nx">enc</span> <span class="o">=</span> <span class="s1">&#39;utf16-be&#39;</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="kd">let</span> <span class="nx">ret</span> <span class="o">=</span> <span class="nx">rs</span><span class="p">.</span><span class="nx">removeAllListeners</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">)</span>         <span class="c1">// remove listener
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                        <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">iconv</span><span class="p">.</span><span class="nx">decodeStream</span><span class="p">(</span><span class="nx">enc</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">            <span class="nx">ret</span><span class="p">.</span><span class="nx">__src</span> <span class="o">=</span> <span class="nx">rs</span>
</span></span><span class="line"><span class="cl">            <span class="nx">ret</span><span class="p">.</span><span class="nx">close</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">__src</span><span class="p">.</span><span class="nx">close</span><span class="p">()}</span>
</span></span><span class="line"><span class="cl">            <span class="nx">rs</span><span class="p">.</span><span class="nx">unshift</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span>                                <span class="c1">// put back peeked data
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="nx">resolve</span><span class="p">(</span><span class="nx">ret</span><span class="p">)</span>                                    <span class="c1">// resolve iconv stream
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="p">})</span>
</span></span><span class="line"><span class="cl">        <span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span> <span class="nx">reject</span><span class="p">({</span><span class="nx">src</span><span class="o">:</span> <span class="nx">rs</span><span class="p">,</span> <span class="nx">err</span><span class="o">:</span> <span class="nx">e</span><span class="p">})</span> <span class="p">})</span>
</span></span><span class="line"><span class="cl">    <span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">createStream</span><span class="p">(</span><span class="nx">fname</span><span class="p">,</span> <span class="nx">encoding</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">s</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">s</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">show_data</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="s1">&#39;fs+iconv&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nx">s</span><span class="p">.</span><span class="nx">close</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">})</span>
</span></span><span class="line"><span class="cl">    <span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">log</span><span class="p">(</span><span class="sb">`fs+iconv error: </span><span class="si">${</span><span class="nx">e</span><span class="si">}</span><span class="sb">`</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span></code></pre></div><p>There are 3 files with the same content but encoded in utf8(sample.txt), utf16-le(sample-16le.txt) and utf16-be(sample-16be.txt)</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">&#34;Two wrongs don&#39;t make a right.&#34;
</span></span><span class="line"><span class="cl">When someone has done something bad to you, trying to get revenge will only make things worse.
</span></span><span class="line"><span class="cl">&#34;The pen is mightier than the sword.&#34;
</span></span><span class="line"><span class="cl">Trying to convince people with ideas and words is more effective than trying to force people to do what you want.
</span></span><span class="line"><span class="cl">&#34;When in Rome, do as the Romans.&#34;
</span></span><span class="line"><span class="cl">Act the way that the people around you are acting. This phrase might come in handy when you&#39;re traveling abroad notice that people do things differently than you&#39;re used to.
</span></span><span class="line"><span class="cl">&#34;The squeaky wheel gets the grease.&#34;
</span></span><span class="line"><span class="cl">You can get better service if you complain about something. If you wait patiently, no one&#39;s going to help you.
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># utf8 file: raw stream without encoding, iconv stream auto-detects</span>
</span></span><span class="line"><span class="cl">$ node ex-encoding.js sample.txt
</span></span><span class="line"><span class="cl"><span class="nv">fname</span><span class="o">=</span>sample.txt <span class="nv">encoding</span><span class="o">=</span>undefined
</span></span><span class="line"><span class="cl">fs: <span class="nv">length</span><span class="o">=</span><span class="m">636</span>
</span></span><span class="line"><span class="cl">    <span class="m">34</span> <span class="m">84</span> <span class="m">119</span> <span class="m">111</span> <span class="m">32</span> <span class="m">119</span> <span class="m">114</span> <span class="m">111</span> <span class="m">110</span> <span class="m">103</span> <span class="m">115</span> <span class="m">32</span> <span class="m">100</span> <span class="m">111</span> <span class="m">110</span> <span class="m">39</span>
</span></span><span class="line"><span class="cl">fs+iconv: <span class="nv">length</span><span class="o">=</span><span class="m">636</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;Two wrongs don&#39;t make a right.&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># utf16-le file: raw stream without encoding, iconv stream auto-detects</span>
</span></span><span class="line"><span class="cl">$ node ex-encoding.js sample-16le.txt
</span></span><span class="line"><span class="cl"><span class="nv">fname</span><span class="o">=</span>sample-16le.txt <span class="nv">encoding</span><span class="o">=</span>undefined
</span></span><span class="line"><span class="cl">fs: <span class="nv">length</span><span class="o">=</span><span class="m">1274</span>
</span></span><span class="line"><span class="cl">    <span class="m">255</span> <span class="m">254</span> <span class="m">34</span> <span class="m">0</span> <span class="m">84</span> <span class="m">0</span> <span class="m">119</span> <span class="m">0</span> <span class="m">111</span> <span class="m">0</span> <span class="m">32</span> <span class="m">0</span> <span class="m">119</span> <span class="m">0</span> <span class="m">114</span> <span class="m">0</span>
</span></span><span class="line"><span class="cl">fs+iconv: <span class="nv">length</span><span class="o">=</span><span class="m">636</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;Two wrongs don&#39;t make a right.&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># utf16-be file: raw stream without encoding, iconv stream auto-detects</span>
</span></span><span class="line"><span class="cl">$ node ex-encoding.js sample-16be.txt
</span></span><span class="line"><span class="cl"><span class="nv">fname</span><span class="o">=</span>sample-16be.txt <span class="nv">encoding</span><span class="o">=</span>undefined
</span></span><span class="line"><span class="cl">fs: <span class="nv">length</span><span class="o">=</span><span class="m">1274</span>
</span></span><span class="line"><span class="cl">    <span class="m">254</span> <span class="m">255</span> <span class="m">0</span> <span class="m">34</span> <span class="m">0</span> <span class="m">84</span> <span class="m">0</span> <span class="m">119</span> <span class="m">0</span> <span class="m">111</span> <span class="m">0</span> <span class="m">32</span> <span class="m">0</span> <span class="m">119</span> <span class="m">0</span> <span class="m">114</span>
</span></span><span class="line"><span class="cl">fs+iconv: <span class="nv">length</span><span class="o">=</span><span class="m">636</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;Two wrongs don&#39;t make a right.&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># utf8 file: raw stream with utf8, iconv stream is not created</span>
</span></span><span class="line"><span class="cl">$ node ex-encoding.js sample.txt utf8
</span></span><span class="line"><span class="cl"><span class="nv">fname</span><span class="o">=</span>sample.txt <span class="nv">encoding</span><span class="o">=</span>utf8
</span></span><span class="line"><span class="cl">fs: <span class="nv">length</span><span class="o">=</span><span class="m">636</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;Two wrongs don&#39;t make a right.&#34;</span>
</span></span><span class="line"><span class="cl">fs+iconv: <span class="nv">length</span><span class="o">=</span><span class="m">636</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;Two wrongs don&#39;t make a right.&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># utf16le file: fs stream doesn&#39;t recognize utf16-le, iconv stream usees the encoding directly</span>
</span></span><span class="line"><span class="cl">$ node ex-encoding.js sample-16le.txt utf16-le
</span></span><span class="line"><span class="cl"><span class="nv">fname</span><span class="o">=</span>sample-16le.txt <span class="nv">encoding</span><span class="o">=</span>utf16-le
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">fs.createReadStream: TypeError <span class="o">[</span>ERR_INVALID_OPT_VALUE_ENCODING<span class="o">]</span>: The value <span class="s2">&#34;utf16-le&#34;</span> is invalid <span class="k">for</span> option <span class="s2">&#34;encoding&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">fs+iconv: <span class="nv">length</span><span class="o">=</span><span class="m">636</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;Two wrongs don&#39;t make a right.&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># utf16le file: fs stream knows ucs2 and utf16le, iconv stream is not used</span>
</span></span><span class="line"><span class="cl">$ node ex-encoding.js sample-16le.txt ucs2
</span></span><span class="line"><span class="cl"><span class="nv">fname</span><span class="o">=</span>sample-16le.txt <span class="nv">encoding</span><span class="o">=</span>ucs2
</span></span><span class="line"><span class="cl">fs: <span class="nv">length</span><span class="o">=</span><span class="m">637</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;Two wrongs don&#39;t make a right.&#34;</span>
</span></span><span class="line"><span class="cl">fs+iconv: <span class="nv">length</span><span class="o">=</span><span class="m">636</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;Two wrongs don&#39;t make a right.&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># utf16be file: fs stream doesn&#39;t knows utf16-le, iconv stream uses (wrong) encoding directly</span>
</span></span><span class="line"><span class="cl">$ node ex-encoding.js sample-16be.txt utf16-le
</span></span><span class="line"><span class="cl"><span class="nv">fname</span><span class="o">=</span>sample-16be.txt <span class="nv">encoding</span><span class="o">=</span>utf16-le
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">fs.createReadStream: TypeError <span class="o">[</span>ERR_INVALID_OPT_VALUE_ENCODING<span class="o">]</span>: The value <span class="s2">&#34;utf16-le&#34;</span> is invalid <span class="k">for</span> option <span class="s2">&#34;encoding&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">fs+iconv: <span class="nv">length</span><span class="o">=</span><span class="m">637</span>
</span></span><span class="line"><span class="cl">    ￾∀吀眀漀 眀爀漀渀最猀 搀漀渀✀琀 洀愀欀攀 愀 爀椀最栀琀⸀
</span></span></code></pre></div>

</div>
</div>

    
    
    
</body>
</html>
