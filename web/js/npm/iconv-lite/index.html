<!DOCTYPE html>
<html lang="en">




  <head>
    <meta charset="utf-8">
<title>My Hugo</title>
<link rel="stylesheet" type="text/css" href="/css/syntax.css">
<link rel="stylesheet" type="text/css" href="/css/site.css">
<script src="/js/nav.js"></script>

    

<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://cdnjs.cloudflare.com/ajax/libs/vue/3.3.4/vue.global.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/js-yaml/4.1.0/js-yaml.min.js"></script>



  </head>

  <body>
    
 <div id="menu-container"></div>

 


    
  
<div class="van-content-container">
  <div id="index-container" class="van-content-index"></div>
  <div class="van-content">
    <h1>iconv-lite</h1>
    <p>This script opens a file stream and detect the encoding.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">log</span> <span class="o">=</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;fs&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">iconv</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;iconv-lite&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">args</span> <span class="o">=</span> <span class="nx">process</span><span class="p">.</span><span class="nx">argv</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">fname</span> <span class="o">=</span> <span class="nx">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">||</span> <span class="s1">&#39;sample.txt&#39;</span>
</span></span><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">encoding</span> <span class="o">=</span> <span class="nx">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">log</span><span class="p">(</span><span class="sb">`fname=</span><span class="si">${</span><span class="nx">fname</span><span class="si">}</span><span class="sb"> encoding=</span><span class="si">${</span><span class="nx">encoding</span><span class="si">}</span><span class="sb">`</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// show upto 16 items of data or 33 characters if data is string
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">function</span> <span class="nx">show_data</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="nx">title</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">log</span><span class="p">(</span><span class="sb">`</span><span class="si">${</span><span class="nx">title</span><span class="si">}</span><span class="sb">: length=</span><span class="si">${</span><span class="nx">data</span><span class="p">.</span><span class="nx">length</span><span class="si">}</span><span class="sb">`</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">data</span> <span class="o">===</span> <span class="s1">&#39;string&#39;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">log</span><span class="p">(</span><span class="sb">`    </span><span class="si">${</span><span class="nx">data</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">33</span><span class="p">)</span><span class="si">}</span><span class="sb">`</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">log</span><span class="p">(</span><span class="sb">`    </span><span class="si">${</span><span class="nx">data</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">16</span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span><span class="si">}</span><span class="sb">`</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// use fs stream directly: node.js has limited encodings
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">try</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">fs</span><span class="p">.</span><span class="nx">createReadStream</span><span class="p">(</span><span class="nx">fname</span><span class="p">,</span> <span class="p">{</span><span class="nx">encoding</span><span class="o">:</span> <span class="nx">encoding</span><span class="p">})</span>
</span></span><span class="line"><span class="cl">    <span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">        <span class="nx">show_data</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="s1">&#39;fs&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">this</span><span class="p">.</span><span class="nx">close</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">})</span>
</span></span><span class="line"><span class="cl">    <span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;fs.createReadStream: error&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">log</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="k">catch</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">log</span><span class="p">(</span><span class="sb">`\nfs.createReadStream: </span><span class="si">${</span><span class="nx">e</span><span class="si">}</span><span class="sb">\n`</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// create a stream (returned from a resolved promise)
</span></span></span><span class="line"><span class="cl"><span class="c1">// that uses iconv-lite as a helper if needed
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">async</span> <span class="kd">function</span> <span class="nx">createStream</span><span class="p">(</span><span class="nx">fname</span><span class="p">,</span> <span class="nx">encoding</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nx">encoding</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// if node.js knows it, use it directly
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="k">return</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">createReadStream</span><span class="p">(</span><span class="nx">fname</span><span class="p">,</span> <span class="p">{</span><span class="nx">encoding</span><span class="o">:</span> <span class="nx">encoding</span><span class="p">})</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// otherwise pipe the fs stream to iconv and let iconv decode
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="c1">// fs will check encoding before perform real create
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="kd">var</span> <span class="nx">rs</span> <span class="o">=</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">createReadStream</span><span class="p">(</span><span class="nx">fname</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="kd">var</span> <span class="nx">es</span> <span class="o">=</span> <span class="nx">rs</span><span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">iconv</span><span class="p">.</span><span class="nx">decodeStream</span><span class="p">(</span><span class="nx">encoding</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">            <span class="nx">es</span><span class="p">.</span><span class="nx">__src</span> <span class="o">=</span> <span class="nx">rs</span>
</span></span><span class="line"><span class="cl">            <span class="nx">es</span><span class="p">.</span><span class="nx">close</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">__src</span><span class="p">.</span><span class="nx">close</span><span class="p">()}</span>  <span class="c1">// simulate rs.close
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="k">return</span> <span class="nx">es</span>                                   <span class="c1">// resolve iconv stream
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// encoding is not specified, peek the first chunk, detect the encoding, then pipe through
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">return</span> <span class="k">new</span> <span class="nb">Promise</span><span class="p">((</span><span class="nx">resolve</span><span class="p">,</span> <span class="nx">reject</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kd">var</span> <span class="nx">rs</span> <span class="o">=</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">createReadStream</span><span class="p">(</span><span class="nx">fname</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nx">rs</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="kd">let</span> <span class="nx">enc</span> <span class="o">=</span> <span class="s1">&#39;utf8&#39;</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="p">((</span><span class="nx">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mh">0xff</span> <span class="o">&amp;&amp;</span> <span class="nx">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mh">0xfe</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="nx">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="nx">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="nx">enc</span> <span class="o">=</span> <span class="s1">&#39;utf16-le&#39;</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">((</span><span class="nx">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mh">0xfe</span> <span class="o">&amp;&amp;</span> <span class="nx">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mh">0xff</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="nx">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="nx">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="nx">enc</span> <span class="o">=</span> <span class="s1">&#39;utf16-be&#39;</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="kd">let</span> <span class="nx">ret</span> <span class="o">=</span> <span class="nx">rs</span><span class="p">.</span><span class="nx">removeAllListeners</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">)</span>         <span class="c1">// remove listener
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                        <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">iconv</span><span class="p">.</span><span class="nx">decodeStream</span><span class="p">(</span><span class="nx">enc</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">            <span class="nx">ret</span><span class="p">.</span><span class="nx">__src</span> <span class="o">=</span> <span class="nx">rs</span>
</span></span><span class="line"><span class="cl">            <span class="nx">ret</span><span class="p">.</span><span class="nx">close</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">__src</span><span class="p">.</span><span class="nx">close</span><span class="p">()}</span>
</span></span><span class="line"><span class="cl">            <span class="nx">rs</span><span class="p">.</span><span class="nx">unshift</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span>                                <span class="c1">// put back peeked data
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="nx">resolve</span><span class="p">(</span><span class="nx">ret</span><span class="p">)</span>                                    <span class="c1">// resolve iconv stream
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="p">})</span>
</span></span><span class="line"><span class="cl">        <span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span> <span class="nx">reject</span><span class="p">({</span><span class="nx">src</span><span class="o">:</span> <span class="nx">rs</span><span class="p">,</span> <span class="nx">err</span><span class="o">:</span> <span class="nx">e</span><span class="p">})</span> <span class="p">})</span>
</span></span><span class="line"><span class="cl">    <span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">createStream</span><span class="p">(</span><span class="nx">fname</span><span class="p">,</span> <span class="nx">encoding</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">s</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">s</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">show_data</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="s1">&#39;fs+iconv&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nx">s</span><span class="p">.</span><span class="nx">close</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">})</span>
</span></span><span class="line"><span class="cl">    <span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">log</span><span class="p">(</span><span class="sb">`fs+iconv error: </span><span class="si">${</span><span class="nx">e</span><span class="si">}</span><span class="sb">`</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">})</span>
</span></span></code></pre></div><p>There are 3 files with the same content but encoded in utf8(sample.txt), utf16-le(sample-16le.txt) and utf16-be(sample-16be.txt)</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-txt" data-lang="txt"><span class="line"><span class="cl">&#34;Two wrongs don&#39;t make a right.&#34;
</span></span><span class="line"><span class="cl">When someone has done something bad to you, trying to get revenge will only make things worse.
</span></span><span class="line"><span class="cl">&#34;The pen is mightier than the sword.&#34;
</span></span><span class="line"><span class="cl">Trying to convince people with ideas and words is more effective than trying to force people to do what you want.
</span></span><span class="line"><span class="cl">&#34;When in Rome, do as the Romans.&#34;
</span></span><span class="line"><span class="cl">Act the way that the people around you are acting. This phrase might come in handy when you&#39;re traveling abroad notice that people do things differently than you&#39;re used to.
</span></span><span class="line"><span class="cl">&#34;The squeaky wheel gets the grease.&#34;
</span></span><span class="line"><span class="cl">You can get better service if you complain about something. If you wait patiently, no one&#39;s going to help you.
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="c1"># utf8 file: raw stream without encoding, iconv stream auto-detects</span>
</span></span><span class="line"><span class="cl">$ node ex-encoding.js sample.txt
</span></span><span class="line"><span class="cl"><span class="nv">fname</span><span class="o">=</span>sample.txt <span class="nv">encoding</span><span class="o">=</span>undefined
</span></span><span class="line"><span class="cl">fs: <span class="nv">length</span><span class="o">=</span><span class="m">636</span>
</span></span><span class="line"><span class="cl">    <span class="m">34</span> <span class="m">84</span> <span class="m">119</span> <span class="m">111</span> <span class="m">32</span> <span class="m">119</span> <span class="m">114</span> <span class="m">111</span> <span class="m">110</span> <span class="m">103</span> <span class="m">115</span> <span class="m">32</span> <span class="m">100</span> <span class="m">111</span> <span class="m">110</span> <span class="m">39</span>
</span></span><span class="line"><span class="cl">fs+iconv: <span class="nv">length</span><span class="o">=</span><span class="m">636</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;Two wrongs don&#39;t make a right.&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># utf16-le file: raw stream without encoding, iconv stream auto-detects</span>
</span></span><span class="line"><span class="cl">$ node ex-encoding.js sample-16le.txt
</span></span><span class="line"><span class="cl"><span class="nv">fname</span><span class="o">=</span>sample-16le.txt <span class="nv">encoding</span><span class="o">=</span>undefined
</span></span><span class="line"><span class="cl">fs: <span class="nv">length</span><span class="o">=</span><span class="m">1274</span>
</span></span><span class="line"><span class="cl">    <span class="m">255</span> <span class="m">254</span> <span class="m">34</span> <span class="m">0</span> <span class="m">84</span> <span class="m">0</span> <span class="m">119</span> <span class="m">0</span> <span class="m">111</span> <span class="m">0</span> <span class="m">32</span> <span class="m">0</span> <span class="m">119</span> <span class="m">0</span> <span class="m">114</span> <span class="m">0</span>
</span></span><span class="line"><span class="cl">fs+iconv: <span class="nv">length</span><span class="o">=</span><span class="m">636</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;Two wrongs don&#39;t make a right.&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># utf16-be file: raw stream without encoding, iconv stream auto-detects</span>
</span></span><span class="line"><span class="cl">$ node ex-encoding.js sample-16be.txt
</span></span><span class="line"><span class="cl"><span class="nv">fname</span><span class="o">=</span>sample-16be.txt <span class="nv">encoding</span><span class="o">=</span>undefined
</span></span><span class="line"><span class="cl">fs: <span class="nv">length</span><span class="o">=</span><span class="m">1274</span>
</span></span><span class="line"><span class="cl">    <span class="m">254</span> <span class="m">255</span> <span class="m">0</span> <span class="m">34</span> <span class="m">0</span> <span class="m">84</span> <span class="m">0</span> <span class="m">119</span> <span class="m">0</span> <span class="m">111</span> <span class="m">0</span> <span class="m">32</span> <span class="m">0</span> <span class="m">119</span> <span class="m">0</span> <span class="m">114</span>
</span></span><span class="line"><span class="cl">fs+iconv: <span class="nv">length</span><span class="o">=</span><span class="m">636</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;Two wrongs don&#39;t make a right.&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># utf8 file: raw stream with utf8, iconv stream is not created</span>
</span></span><span class="line"><span class="cl">$ node ex-encoding.js sample.txt utf8
</span></span><span class="line"><span class="cl"><span class="nv">fname</span><span class="o">=</span>sample.txt <span class="nv">encoding</span><span class="o">=</span>utf8
</span></span><span class="line"><span class="cl">fs: <span class="nv">length</span><span class="o">=</span><span class="m">636</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;Two wrongs don&#39;t make a right.&#34;</span>
</span></span><span class="line"><span class="cl">fs+iconv: <span class="nv">length</span><span class="o">=</span><span class="m">636</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;Two wrongs don&#39;t make a right.&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># utf16le file: fs stream doesn&#39;t recognize utf16-le, iconv stream usees the encoding directly</span>
</span></span><span class="line"><span class="cl">$ node ex-encoding.js sample-16le.txt utf16-le
</span></span><span class="line"><span class="cl"><span class="nv">fname</span><span class="o">=</span>sample-16le.txt <span class="nv">encoding</span><span class="o">=</span>utf16-le
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">fs.createReadStream: TypeError <span class="o">[</span>ERR_INVALID_OPT_VALUE_ENCODING<span class="o">]</span>: The value <span class="s2">&#34;utf16-le&#34;</span> is invalid <span class="k">for</span> option <span class="s2">&#34;encoding&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">fs+iconv: <span class="nv">length</span><span class="o">=</span><span class="m">636</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;Two wrongs don&#39;t make a right.&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># utf16le file: fs stream knows ucs2 and utf16le, iconv stream is not used</span>
</span></span><span class="line"><span class="cl">$ node ex-encoding.js sample-16le.txt ucs2
</span></span><span class="line"><span class="cl"><span class="nv">fname</span><span class="o">=</span>sample-16le.txt <span class="nv">encoding</span><span class="o">=</span>ucs2
</span></span><span class="line"><span class="cl">fs: <span class="nv">length</span><span class="o">=</span><span class="m">637</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;Two wrongs don&#39;t make a right.&#34;</span>
</span></span><span class="line"><span class="cl">fs+iconv: <span class="nv">length</span><span class="o">=</span><span class="m">636</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;Two wrongs don&#39;t make a right.&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># utf16be file: fs stream doesn&#39;t knows utf16-le, iconv stream uses (wrong) encoding directly</span>
</span></span><span class="line"><span class="cl">$ node ex-encoding.js sample-16be.txt utf16-le
</span></span><span class="line"><span class="cl"><span class="nv">fname</span><span class="o">=</span>sample-16be.txt <span class="nv">encoding</span><span class="o">=</span>utf16-le
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">fs.createReadStream: TypeError <span class="o">[</span>ERR_INVALID_OPT_VALUE_ENCODING<span class="o">]</span>: The value <span class="s2">&#34;utf16-le&#34;</span> is invalid <span class="k">for</span> option <span class="s2">&#34;encoding&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">fs+iconv: <span class="nv">length</span><span class="o">=</span><span class="m">637</span>
</span></span><span class="line"><span class="cl">    ￾∀吀眀漀 眀爀漀渀最猀 搀漀渀✀琀 洀愀欀攀 愀 爀椀最栀琀⸀
</span></span></code></pre></div>
  </div>
</div>



    
    
    

    
    <script src="/js/menu-module.js"></script>
    <script src="/js/index-module.js"></script>
  </body>

</html>
